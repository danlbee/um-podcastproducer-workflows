// Upload to Dental School Testing Area - with Intro and Outro 
(
    {
        name = "$$Xgrid Job Name$$"; 

        artSpecifications = {
            0 = {
                artPath = "$$Workflow Resource Path$$/Tools/art.rb"; 
				
                artArguments = ("$$Shared Filesystem$$", "$$Server UUID$$"); 
            }; 
        };
		
        artConditions = {0 = {artEqual = 1; }; }; 

        taskSpecifications = {
          preflight = {
            command = "/usr/bin/pcastaction";
            arguments = (
              preflight,
              "--basedir=$$Base Directory$$"
            );
          };
          
          // Handle the Audio by encoding it for iPod
          encode_audio = {
            dependsOnTasks = (preflight); 
            command = "/usr/bin/pcastaction";
            arguments = (
              encode,
              "--basedir=$$Base Directory$$",
              "--input=$$Content File Basename$$$$Content File Extension$$",
              "--output=$$Content File Basename$$-audio.m4v",
              "--encoder=mp4_audio_high"
            );
          };
          
          // Handle the video by adding pre-roll and post-roll video to it
          add_intro_to_video = {
            dependsOnTasks = (preflight);
            command = "/usr/bin/pcastaction";
            arguments = (
              merge,
              "--basedir=$$Base Directory$$",
              "--input1=$$Introduction Video Path$$",
              "--input2=$$Content File Basename$$$$Content File Extension$$",
              "--transition=$$Quartz Composer Exit Transition$$",
              "--duration=$$Intro Transition Duration$$",
              "--output=$$Content File Basename$$-with-intro.mov"
            );
          };
          add_exit_to_video = {
            dependsOnTasks = (add_intro_to_video);
            command = "/usr/bin/pcastaction";
            arguments = (
              merge,
              "--basedir=$$Base Directory$$",
              "--input1=$$Content File Basename$$-with-intro.mov",
              "--input2=$$Exit Video Path$$",
              "--transition=$$Quartz Composer Exit Transition$$",
              "--duration=$$Exit Transition Duration$$",
              "--output=$$Content File Basename$$-with-exit.mov"
            );
          };
          
          // Encode the combined intro|video|exit video
          encode_video = {
            dependsOnTasks = (add_intro_to_video, add_exit_to_video);
            command = "/usr/bin/pcastaction";
            arguments = (
              encode,
              "--basedir=$$Base Directory$$",
              "--input=$$Content File Basename$$-with-exit.mov",
              "--output=$$Content File Basename$$-video.m4v",
              "--encoder=ipod"
            );
          };
          
          // Publish:
          // After video has been intro/outro'ed and ecoded
          // and audio has been encoded
          // send both finished files off to iTunes U
          // We wait on both encoding tasks so
          // if upload fails we still end up with usable files
          publish_audio_to_itunesu = {
            dependsOnTasks = (encode_audio, encode_video); 
            command = "/usr/bin/pcastaction";
            arguments = (
              iTunesU,
              "--basedir=$$Base Directory$$",
              "--input=$$Content File Basename$$-audio.m4v",
              "--title=$$Title$$",
              "--description=$$Description$$",
              "--site_url=$$iTunes U Site URL$$",
              "--tab_id=1419234028.01647873680",
              "--credential=$$iTunes U Posting Credentials$$",
              "--display_name=NAME",
              "--email=EMAIL",
              "--user=SHORTNAME ",
              "--user_id=0",
              "--pcast_server=$$Podcast Producer URL$$",
              "--otp=##iTunes U Shared Secret##"
            );
          };
          publish_video_to_itunesu = {
            dependsOnTasks = (encode_video, encode_audio); 
            command = "/usr/bin/pcastaction";
            arguments = (
              iTunesU,
              "--basedir=$$Base Directory$$",
              "--input=$$Content File Basename$$-video.m4v",
              "--title=$$Title$$",
              "--description=$$Description$$",
              "--site_url=$$iTunes U Site URL$$",
              "--tab_id=1419234028.01419234030",
              "--credential=$$iTunes U Posting Credentials$$",
              "--display_name=NAME",
              "--email=EMAIL ",
              "--user=SHORTNAME ",
              "--user_id=0",
              "--pcast_server=$$Podcast Producer URL$$",
              "--otp=##iTunes U Shared Secret##"
            );
          };
          postflight = {
            dependsOnTasks = (publish_audio_to_itunesu, publish_video_to_itunesu);
            command = "/usr/bin/pcastaction";
            arguments = (
              postflight,
              "--basedir=$$Base Directory$$"
            );
          };
        };
	  }
)
		
